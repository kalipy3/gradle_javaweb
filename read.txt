read.txt

:Author: kalipy
:Email: kalipy@debian
:Date: 2020-09-17 23:07

BookStore项目

1.需求分析，建立模型
    建立登录注册相关模型(Bean层)
        建立用户表
            当数据库表很多时候，也要分层，一般按照命名规则分层即可
                create database bookstore_01

                create table bs_user(
                    id int(12) primary key auto_increment,
                    username varchar(100) not null unique,
                    password varchar(100) not null,
                    email varchar(100)
                )

        建立对应的User类

    建立Dao层：操作数据库
        JDBCUtils:用来获取数据库连接,使用c3p0获取连接
            导包 mysql-connector.jar c3p0.jar commons-dbutils.jar

        建立BaseDao,专门用来被其他的dao继承，BaseDao定义了一些基本的操作
            BaseDao<T>:
                public T getBean()
                public List<T> getBeanList()
                public int update()

        USerDao:操作User表的Dao类
            面向接口编程
                定义一个UserDao接口 定义UserDao有什么方法
                    UserDao接口：
                        User getUserByUserNameAndPassWord(User user);
                        boolean registUser(User user);

    建立Service层
        UserService:完成登录注册功能
        面向接口编程
            UserService接口：
                User login(User user);
                boolean regist(User users);


    建立Servlet层：处理用户请求
        LoginServlet:处理登录请求
        RegistServlet:处理注册请求

    界面
        修改响应逻辑
       

--------------------------------------------------------------------------

第三阶段 项目优化
2.登录注册，如果发生错误应该有错误提示信息
    错误提示：
        1.用户输入用户名密码
        2.发送登录请求
        3.登录servlet来处理登录请求-->查用户
            成功：重定向到页面
            失败：转发到登录页面
        4.又会在浏览器上显示登录页面。想要在登录页面动态获取错误信息，在转发之前，设置一个错误消息提示，把它放在域中。jsp就可以在域中取数据

3.表单回显
    当登录或注册失败时，回到登录或注册页面我们希望将之前填写的信息保留(表单回显)

4.优化servlet的逻辑
    一个请求对应了一个Servlet
        UserService-->login(),regist(),xx()和用户相关的业务逻辑都放在了UserService.
     问题：
        可不可以和用户相关的请求(登录，注册..等)放在一个Servlet里

        和用户相关的请求    UserServlet
        和图书相关的请求    BookServlet
        ...

     分析：
        注册，登录 都被UserServlet-->所以注册登录都请求同一个地址
        可以为请求添加一个method字段，提交的时候,带上method值
        if(method.eqauls("regist"))调用注册方法
        if(method.eqauls("login"))调用登录方法

     问题：
        上面看起来好像没什么问题了，但是，get请求时，表单的数据会被带上，而之前请求地址中的数据会被表单数据覆盖掉,请运行代码测试

        解决：
            添加一个隐藏的表单项
            <input type="hidden" name="method" value="login">
            <input type="hidden" name="method" value="regist">

     为了不陷入层层的if判断，我们改用反射也来实现一下

     所有的Servlet都是通过反射来调用相应的方法，所以我们可以抽取一个BaseServlet
        
        用户发送请求
        method=regist/login ----------->    BaseServlet
                                            doGet()
           UserServlet    <-----------------doPost()
           regist()
           login()
              |
              |
             \|/
             完成响应


5.我们使用分层结构
    Servlet-->Service-->Dao-->bean:在系统中数据都使用对象包装
    注册：第一步：来到注册Servlet,获取数据封装对象
    登录：第一步：来到登录Servlet,获取数据封装对象

    xxx:第一步：来到xxServlet，获取数据封装对象

    我们应该将获取数据，封装对象这个过程抽取出来
    因为封装对象，还牵扯到数据转型，很麻烦..
        User user = Utils.param2Bean(t);
    我们希望抽取为一个自动化的工具。根据我们的需求，自动的封装对象，可以智能的帮我们封装数据。

    反射...
    requset里面带了好多参数....,根据要封装的对象获取相应的参数进行封装
    beanutils有丰富的操作javaBean的方法
    导包：commons-beanutils.jar commons-logging.jar
        String username = req.getParameter("username");
        String password = req.getParameter("password");
        String email = req.getParameter("email");
    
    由于request获取的数据都是String类型的，要封装成Bean的话，需要类型装换.
        w3m build/reports/tests/test/index.html
    注意：在build.gradle中加了jar包之后，gradle build之后，要unzip build/distributions/gradle_javaweb.zip!!!!不然tomcat找不到需要的class 

    javaBean的属性值的设置是按照getter setter方法定的
    属性真正的名字是get或set后面的字符串,而不是Student等类的privat String username等字段

-------------------------------------------------------------------------

第四阶段 使用el进行错误消息提示及表单回显
    以前都是使用jsp表达式
    el->获取数据方便。如果没有属性就是什么都没有，而不是在页面显示null。即不用做三元运算

--------------------------------------------------------------------------

第五阶段 图书馆后台管理的增删改查以及前端显示
    1.后端的图书管理功能
        1.显示层:页面
        2.控制层：Servlet
        3.业务逻辑层：Service
        4.持久化层:Dao
        5.模型层：Bean
        6.数据库对应的表

        6.创建图书相关的表。哪些字段?
            主键    自增
            书名    varchar
            作者    varchar
            价格    double(11,2)
            销量    int
            库存    int
            封面图片    只保存图书封面的图片路径，绝对路径,base标签。保存图片相对于当前项目的路径 <img src="">
        
        7.对应的javaBean
            book
            Integer id;
            String title;
            String author;
            double price;
            int sales;
            int stock;
            String imgPath;

        8.创建sql:
            create table bs_book(
                id int(11) primary key auto_increment,
                title varchar(100) not null,
                author varchar(100) not null,
                price double(11,2),
                sales int(11),
                stock int(11),
                img_path varchar(200)
            )


开发数据库层
    面向接口开发
    接口类：BookDao
    接口方法：
        List<Book> getAllBook()显示所有图书
        boolean addBook(Book book);增加图书
        boolean delBook(Book book);删除图书
        boolean updateBook(Book book);修改图书
        Book getBook(Book book);找一本图书

    BookDaoimpl
    BookDaoimpl extends BaseDao<Book> implements BookDao

    
业务逻辑层
    增删改查    面向接口编程
    BookService(接口interface)
        add(Book book)
        update(Book book)//修改图书
        delete(Book book)
        getOne(Book book)
        getAll()//获取所有图书

    2.Servlet,控制器Controller,用来控制页面转发(见servlet.png)
        1.用户点击图书管理，显示所有的图书
            http://127.0.0.1:8080/01Servlet/pages/manager/book_manager.jsp
            点击图书管理-->交给Servlet-->查出数据-->交给页面显示
            BookManagerServlet
                list()//处理显示图书列表的请求

        2.添加图书
            1.用户点击添加图书-->链接到图书添加页面(book_edit.jsp)
                                 用户在页面输入图书的详细信息，点击提交
                                            |
                                           \|/
                                  BookManagerServlet
                                  add()添加图书，添加成功后还是显示图书列表
                                  重新请求列表显示方法list()
                   
        3.删除图书
            用户点击删除-->Servlet接受请求-->按照图书id删除图书-->还是回到图书列表页面
